# VideoMaker Linux å¿«é€Ÿéƒ¨ç½²æŒ‡å—

## ðŸš€ ä¸€é”®éƒ¨ç½² (æŽ¨è)

### 1. å‡†å¤‡æœåŠ¡å™¨
- Ubuntu 18.04+ æˆ– CentOS 7+ 
- 2GB+ å†…å­˜
- 10GB+ å­˜å‚¨ç©ºé—´

### 2. ä¸Šä¼ é¡¹ç›®æ–‡ä»¶
```bash
# åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºç›®å½•
sudo mkdir -p /home/videomaker/apps
sudo chown -R $USER:$USER /home/videomaker

# ä¸Šä¼ æ•´ä¸ªvideomakeré¡¹ç›®åˆ°æœåŠ¡å™¨
scp -r videomaker/ user@your-server:/home/videomaker/apps/

# æˆ–ä½¿ç”¨rsync
rsync -avz videomaker/ user@your-server:/home/videomaker/apps/videomaker/
```

### 3. è¿è¡Œè‡ªåŠ¨éƒ¨ç½²è„šæœ¬
```bash
# åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ
cd /home/videomaker/apps/videomaker/backend
chmod +x deploy_linux.sh
sudo ./deploy_linux.sh
```

## ðŸ“‹ æ‰‹åŠ¨éƒ¨ç½²æ­¥éª¤

### 1. å®‰è£…ç³»ç»Ÿä¾èµ–

**Ubuntu/Debian:**
```bash
sudo apt update && sudo apt upgrade -y
sudo apt install -y python3 python3-pip python3-venv ffmpeg tesseract-ocr redis-server nginx git
```

**CentOS/RHEL:**
```bash
sudo dnf update -y
sudo dnf install -y python3 python3-pip git redis nginx
sudo dnf install -y epel-release
sudo dnf install -y --nogpgcheck https://download1.rpmfusion.org/free/el/rpmfusion-free-release-$(rpm -E %rhel).noarch.rpm
sudo dnf install -y ffmpeg tesseract
```

### 2. åˆ›å»ºåº”ç”¨ç”¨æˆ·
```bash
sudo useradd -m -s /bin/bash videomaker
sudo mkdir -p /home/videomaker/apps
sudo chown -R videomaker:videomaker /home/videomaker
```

### 3. éƒ¨ç½²é¡¹ç›®
```bash
# åˆ‡æ¢åˆ°videomakerç”¨æˆ·
sudo su - videomaker

# è¿›å…¥é¡¹ç›®ç›®å½• (å‡è®¾å·²ä¸Šä¼ )
cd /home/videomaker/apps/videomaker/backend

# åˆ›å»ºè™šæ‹ŸçŽ¯å¢ƒ
python3 -m venv venv
source venv/bin/activate

# å®‰è£…ä¾èµ–
pip install --upgrade pip
pip install -r requirements.txt

# åˆ›å»ºæ•°æ®ç›®å½•
mkdir -p /home/videomaker/data/{uploads,videos,encoded_videos,notes_output,logs}

# åˆ›å»ºçŽ¯å¢ƒé…ç½®
cat > .env << EOF
OPENAI_API_KEY=your_openai_api_key_here
OPENAI_BASE_URL=https://api.openai.com/v1
DEBUG=False
LOG_LEVEL=INFO
HOST=0.0.0.0
PORT=8000
EOF
```

### 4. åˆ›å»ºç³»ç»ŸæœåŠ¡
```bash
# é€€å‡ºvideomakerç”¨æˆ·
exit

# åˆ›å»ºsystemdæœåŠ¡æ–‡ä»¶
sudo tee /etc/systemd/system/videomaker.service << EOF
[Unit]
Description=VideoMaker FastAPI Application
After=network.target

[Service]
Type=exec
User=videomaker
Group=videomaker
WorkingDirectory=/home/videomaker/apps/videomaker/backend
Environment=PATH=/home/videomaker/apps/videomaker/backend/venv/bin
ExecStart=/home/videomaker/apps/videomaker/backend/venv/bin/python -m uvicorn main:app --host 0.0.0.0 --port 8000 --workers 4
Restart=on-failure
RestartSec=5

[Install]
WantedBy=multi-user.target
EOF

# å¯ç”¨å¹¶å¯åŠ¨æœåŠ¡
sudo systemctl daemon-reload
sudo systemctl enable videomaker
sudo systemctl start videomaker
```

### 5. é…ç½®Nginxåå‘ä»£ç†
```bash
# åˆ›å»ºNginxé…ç½®
sudo tee /etc/nginx/sites-available/videomaker << EOF
server {
    listen 80;
    server_name _;
    client_max_body_size 100M;
    
    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host \$host;
        proxy_set_header X-Real-IP \$remote_addr;
        proxy_set_header X-Forwarded-For \$proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto \$scheme;
    }
    
    location /api/videos/ws/ {
        proxy_pass http://127.0.0.1:8000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade \$http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host \$host;
    }
}
EOF

# å¯ç”¨ç«™ç‚¹
sudo ln -s /etc/nginx/sites-available/videomaker /etc/nginx/sites-enabled/
sudo rm -f /etc/nginx/sites-enabled/default
sudo nginx -t
sudo systemctl restart nginx
```

### 6. é…ç½®é˜²ç«å¢™
```bash
# Ubuntu
sudo ufw allow 80
sudo ufw allow 443
sudo ufw allow ssh
sudo ufw enable

# CentOS
sudo firewall-cmd --permanent --add-service=http
sudo firewall-cmd --permanent --add-service=https
sudo firewall-cmd --reload
```

## ðŸ” éªŒè¯éƒ¨ç½²

```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status videomaker
sudo systemctl status nginx

# æµ‹è¯•API
curl http://localhost:8000
curl http://localhost/docs

# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u videomaker -f
```

## ðŸ› ï¸ å¸¸ç”¨ç®¡ç†å‘½ä»¤

```bash
# æœåŠ¡ç®¡ç†
sudo systemctl start videomaker    # å¯åŠ¨
sudo systemctl stop videomaker     # åœæ­¢
sudo systemctl restart videomaker  # é‡å¯
sudo systemctl status videomaker   # çŠ¶æ€

# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u videomaker -f   # å®žæ—¶æ—¥å¿—
sudo journalctl -u videomaker -n 50 # æœ€è¿‘50è¡Œ

# æ›´æ–°åº”ç”¨
cd /home/videomaker/apps/videomaker/backend
sudo -u videomaker git pull        # æ›´æ–°ä»£ç 
sudo systemctl restart videomaker  # é‡å¯æœåŠ¡
```

## ðŸ”§ é…ç½®è¯´æ˜Ž

### é‡è¦é…ç½®æ–‡ä»¶
- **åº”ç”¨é…ç½®**: `/home/videomaker/apps/videomaker/backend/.env`
- **æœåŠ¡é…ç½®**: `/etc/systemd/system/videomaker.service`
- **Nginxé…ç½®**: `/etc/nginx/sites-available/videomaker`

### å¿…éœ€çš„çŽ¯å¢ƒå˜é‡
```env
OPENAI_API_KEY=sk-your-openai-api-key
OPENAI_BASE_URL=https://api.openai.com/v1
DEBUG=False
HOST=0.0.0.0
PORT=8000
```

### ç›®å½•ç»“æž„
```
/home/videomaker/
â”œâ”€â”€ apps/
â”‚   â””â”€â”€ videomaker/
â”‚       â””â”€â”€ backend/          # åº”ç”¨ä»£ç 
â””â”€â”€ data/                     # æ•°æ®ç›®å½•
    â”œâ”€â”€ uploads/              # ä¸Šä¼ æ–‡ä»¶
    â”œâ”€â”€ videos/               # è§†é¢‘æ–‡ä»¶
    â”œâ”€â”€ encoded_videos/       # è½¬ç è¾“å‡º
    â”œâ”€â”€ notes_output/         # ç¬”è®°è¾“å‡º
    â””â”€â”€ logs/                 # æ—¥å¿—æ–‡ä»¶
```

## ðŸ” å®‰å…¨å»ºè®®

1. **æ›´æ”¹é»˜è®¤ç«¯å£**: ä¿®æ”¹SSHç«¯å£ï¼Œç¦ç”¨rootç™»å½•
2. **è®¾ç½®é˜²ç«å¢™**: åªå¼€æ”¾å¿…è¦ç«¯å£
3. **é…ç½®SSL**: ä½¿ç”¨Let's Encrypté…ç½®HTTPS
4. **å®šæœŸæ›´æ–°**: ä¿æŒç³»ç»Ÿå’Œåº”ç”¨æ›´æ–°
5. **å¤‡ä»½æ•°æ®**: å®šæœŸå¤‡ä»½æ•°æ®ç›®å½•

## ðŸ“Š æ€§èƒ½ä¼˜åŒ–

1. **è°ƒæ•´workersæ•°é‡**: æ ¹æ®CPUæ ¸å¿ƒæ•°è®¾ç½®
2. **é…ç½®Redis**: ç”¨äºŽç¼“å­˜å’Œä»»åŠ¡é˜Ÿåˆ—
3. **ä¼˜åŒ–Nginx**: é…ç½®gzipåŽ‹ç¼©å’Œç¼“å­˜
4. **ç›‘æŽ§èµ„æº**: ä½¿ç”¨htopã€iotopç›‘æŽ§ç³»ç»Ÿèµ„æº

## ðŸ†˜ æ•…éšœæŽ’é™¤

### å¸¸è§é—®é¢˜

1. **æœåŠ¡å¯åŠ¨å¤±è´¥**
   ```bash
   sudo journalctl -u videomaker -n 20
   ```

2. **APIæ— å“åº”**
   ```bash
   sudo netstat -tlnp | grep 8000
   curl -I http://localhost:8000
   ```

3. **ä¾èµ–é—®é¢˜**
   ```bash
   cd /home/videomaker/apps/videomaker/backend
   source venv/bin/activate
   pip install -r requirements.txt --force-reinstall
   ```

4. **æƒé™é—®é¢˜**
   ```bash
   sudo chown -R videomaker:videomaker /home/videomaker/
   ```

## ðŸ“ž èŽ·å–å¸®åŠ©

- æŸ¥çœ‹APIæ–‡æ¡£: http://your-server/docs
- æ£€æŸ¥æœåŠ¡æ—¥å¿—: `sudo journalctl -u videomaker -f`
- éªŒè¯é…ç½®: `nginx -t` å’Œ `systemctl status videomaker`

---

**ðŸŽ‰ éƒ¨ç½²å®ŒæˆåŽï¼Œè®¿é—® `http://your-server-ip` å¼€å§‹ä½¿ç”¨VideoMakerï¼**

---
*å¿«é€Ÿéƒ¨ç½²æŒ‡å— - 2024å¹´7æœˆ9æ—¥* 